<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Y::Awareness
  
    &mdash; Documentation by YARD 0.9.36
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Y::Awareness";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Y.html" title="Y (module)">Y</a></span></span>
     &raquo; 
    <span class="title">Awareness</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Y::Awareness
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Y::Awareness</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/y/awareness.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>The Awareness class implements a simple shared state protocol that can be
used for non-persistent data like awareness information (cursor, username,
status, ..). Each client can update its own local state and listen to state
changes of remote clients.</p>

<p>Each client is identified by a unique client id (something we borrow from
doc.client_id). A client can override its own state by propagating a message
with an increasing timestamp (clock). If such a message is received, it is
applied if the known state of that client is older than the new state
(<code>clock &lt; new_clock</code>). If a client thinks that a remote client is offline,
it may propagate a message with <code>{ clock, state: null, client }</code>. If such a
message is received, and the known clock of that client equals the received
clock, it will clean the state.</p>

<p>Before a client disconnects, it should propagate a null state with an
updated clock.</p>

<p>Awareness is an integral part of collaborative applications, you can read
more about the concept here: <a href="https://docs.yjs.dev/getting-started/adding-awareness">https://docs.yjs.dev/getting-started/adding-awareness</a></p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Instantiate awareness instance and encode update for broadcast</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='lbrace'>{</span>
  <span class='label'>editing:</span> <span class='lbrace'>{</span> <span class='label'>field:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>pos:</span> <span class='int'>0</span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hannes Moser</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>

<span class='id identifier rubyid_awareness'>awareness</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Y.html" title="Y (module)">Y</a></span></span><span class='op'>::</span><span class='const'>Awareness</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_awareness'>awareness</span><span class='period'>.</span><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='id identifier rubyid_local_state'>local_state</span>
<span class='id identifier rubyid_awareness'>awareness</span><span class='period'>.</span><span class='id identifier rubyid_diff'>diff</span> <span class='comment'># [1,227,245,175,195,11,1,65,123, …]</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Two connected clients</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_local_state_a'>local_state_a</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User A</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_client_a'>client_a</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Y.html" title="Y (module)">Y</a></span></span><span class='op'>::</span><span class='const'>Awareness</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_client_a'>client_a</span><span class='period'>.</span><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='id identifier rubyid_local_state'>local_state</span>

<span class='id identifier rubyid_local_state_b'>local_state_b</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User B</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_client_b'>client_b</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Y.html" title="Y (module)">Y</a></span></span><span class='op'>::</span><span class='const'>Awareness</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_client_b'>client_b</span><span class='period'>.</span><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='id identifier rubyid_local_state_b'>local_state_b</span>

<span class='id identifier rubyid_client_a'>client_a</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span><span class='lparen'>(</span><span class='id identifier rubyid_client_b'>client_b</span><span class='period'>.</span><span class='id identifier rubyid_diff'>diff</span><span class='rparen'>)</span>
<span class='id identifier rubyid_client_a'>client_a</span><span class='period'>.</span><span class='id identifier rubyid_clients'>clients</span> <span class='comment'># {1242157267=&gt;&quot;{\&quot;name\&quot;:\&quot;User A\&quot;}&quot;, 2401067547=&gt;…</span></code></pre>
    
  </div>


</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#attach-instance_method" title="#attach (instance method)">#<strong>attach</strong>(callback = nil, &amp;block)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Subscribes to changes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clean_local_state-instance_method" title="#clean_local_state (instance method)">#<strong>clean_local_state</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Clears out a state of a current client, effectively marking it as disconnected.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#client_id-instance_method" title="#client_id (instance method)">#<strong>client_id</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a globally unique client ID of an underlying Doc.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clients-instance_method" title="#clients (instance method)">#<strong>clients</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a state map of all of the clients tracked by current Awareness instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#diff-instance_method" title="#diff (instance method)">#<strong>diff</strong>  &#x21d2; ::Array&lt;Integer&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a serializable update object which is representation of a current Awareness state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#diff_with_clients-instance_method" title="#diff_with_clients (instance method)">#<strong>diff_with_clients</strong>(*clients)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a serializable update object which is representation of a current Awareness state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#local_state-instance_method" title="#local_state (instance method)">#<strong>local_state</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the state of the local Awareness instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#local_state=-instance_method" title="#local_state= (instance method)">#<strong>local_state=</strong>(state)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Sets a current Awareness instance state to a corresponding JSON string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_state-instance_method" title="#remove_state (instance method)">#<strong>remove_state</strong>(client_id)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Clears out a state of a given client, effectively marking it as disconnected.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sync-instance_method" title="#sync (instance method)">#<strong>sync</strong>(diff)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Applies an incoming update.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="attach-instance_method">
  
    #<strong>attach</strong>(callback = nil, &amp;block)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Subscribes to changes</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The subscription ID</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 144</span>

<span class='kw'>def</span> <span class='id identifier rubyid_attach'>attach</span><span class='lparen'>(</span><span class='id identifier rubyid_callback'>callback</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_yawareness_on_update'>yawareness_on_update</span><span class='lparen'>(</span><span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_callback'>callback</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_yawareness_on_update'>yawareness_on_update</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_to_proc'>to_proc</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clean_local_state-instance_method">
  
    #<strong>clean_local_state</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Clears out a state of a current client, effectively marking it as
disconnected.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 68</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clean_local_state'>clean_local_state</span>
  <span class='id identifier rubyid_yawareness_clean_local_state'>yawareness_clean_local_state</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="client_id-instance_method">
  
    #<strong>client_id</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a globally unique client ID of an underlying Doc.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Returns the client_id of the local user</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 75</span>

<span class='kw'>def</span> <span class='id identifier rubyid_client_id'>client_id</span>
  <span class='id identifier rubyid_yawareness_client_id'>yawareness_client_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clients-instance_method">
  
    #<strong>clients</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a state map of all of the clients tracked by current Awareness
instance. Those states are identified by their corresponding ClientIDs.
The associated state is represented and replicated to other clients as a
JSON string.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Instantiate awareness instance and encode update for broadcast</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='lbrace'>{</span>
  <span class='label'>editing:</span> <span class='lbrace'>{</span> <span class='label'>field:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>pos:</span> <span class='int'>0</span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hannes Moser</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>

<span class='id identifier rubyid_awareness'>awareness</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Y.html" title="Y (module)">Y</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Y::Awareness (class)">Awareness</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_awareness'>awareness</span><span class='period'>.</span><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='id identifier rubyid_local_state'>local_state</span>
<span class='id identifier rubyid_awareness'>awareness</span><span class='period'>.</span><span class='id identifier rubyid_clients'>clients</span> <span class='comment'># {312134501=&gt;&quot;{\&quot;editing\&quot;:{\&quot;field\&quot;:\&quot;descriptio …</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>All clients and their current state</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 95</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clients'>clients</span>
  <span class='id identifier rubyid_transform'>transform</span> <span class='op'>=</span> <span class='id identifier rubyid_yawareness_clients'>yawareness_clients</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client_id'>client_id</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='op'>|</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_client_id'>client_id</span><span class='comma'>,</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse!'>parse!</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_transform'>transform</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="diff-instance_method">
  
    #<strong>diff</strong>  &#x21d2; <tt>::Array&lt;Integer&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a serializable update object which is representation of a current
Awareness state.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>::Array&lt;Integer&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Binary encoded update of the local instance</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 163</span>

<span class='kw'>def</span> <span class='id identifier rubyid_diff'>diff</span>
  <span class='id identifier rubyid_yawareness_update'>yawareness_update</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="diff_with_clients-instance_method">
  
    #<strong>diff_with_clients</strong>(*clients)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a serializable update object which is representation of a current
Awareness state. Unlike Awareness::update, this method variant allows to
prepare update only for a subset of known clients. These clients must all
be known to a current Awareness instance, otherwise a
Error::ClientNotFound error will be returned.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>clients</span>
      
      
        <span class='type'>(<tt>::Array&lt;Integer&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A list of client IDs</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Binary encoded update including all given client IDs</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 175</span>

<span class='kw'>def</span> <span class='id identifier rubyid_diff_with_clients'>diff_with_clients</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_clients'>clients</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_yawareness_update_with_clients'>yawareness_update_with_clients</span><span class='lparen'>(</span><span class='id identifier rubyid_clients'>clients</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="local_state-instance_method">
  
    #<strong>local_state</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the state of the local Awareness instance.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Create local state and inspect it</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='lbrace'>{</span>
  <span class='label'>editing:</span> <span class='lbrace'>{</span> <span class='label'>field:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>pos:</span> <span class='int'>0</span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hannes Moser</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>

<span class='id identifier rubyid_awareness'>awareness</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Y.html" title="Y (module)">Y</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Y::Awareness (class)">Awareness</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_awareness'>awareness</span><span class='period'>.</span><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='id identifier rubyid_local_state'>local_state</span>
<span class='id identifier rubyid_awareness'>awareness</span><span class='period'>.</span><span class='id identifier rubyid_local_state'>local_state</span> <span class='comment'># {  editing: { field: &quot;description&quot;, ...</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The current state of the local client</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 115</span>

<span class='kw'>def</span> <span class='id identifier rubyid_local_state'>local_state</span>
  <span class='id identifier rubyid_json'>json</span> <span class='op'>=</span> <span class='id identifier rubyid_yawareness_local_state'>yawareness_local_state</span>
  <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse!'>parse!</span><span class='lparen'>(</span><span class='id identifier rubyid_json'>json</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_json'>json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="local_state=-instance_method">
  
    #<strong>local_state=</strong>(state)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Sets a current Awareness instance state to a corresponding JSON string.
This state will be replicated to other clients as part of the
AwarenessUpdate.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Set local state</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='lbrace'>{</span>
  <span class='label'>editing:</span> <span class='lbrace'>{</span> <span class='label'>field:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>pos:</span> <span class='int'>0</span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hannes Moser</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>

<span class='id identifier rubyid_awareness'>awareness</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Y.html" title="Y (module)">Y</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Y::Awareness (class)">Awareness</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_awareness'>awareness</span><span class='period'>.</span><span class='id identifier rubyid_local_state'>local_state</span> <span class='op'>=</span> <span class='id identifier rubyid_local_state'>local_state</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>state</span>
      
      
        <span class='type'>(<tt>#to_json</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 135</span>

<span class='kw'>def</span> <span class='id identifier rubyid_local_state='>local_state=</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>state cannot be encoded to JSON</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:to_json</span>

  <span class='id identifier rubyid_yawareness_set_local_state'>yawareness_set_local_state</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_state-instance_method">
  
    #<strong>remove_state</strong>(client_id)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Clears out a state of a given client, effectively marking it as
disconnected.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>client_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Clears the state for given client_id</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 155</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_state'>remove_state</span><span class='lparen'>(</span><span class='id identifier rubyid_client_id'>client_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_yawareness_remove_state'>yawareness_remove_state</span><span class='lparen'>(</span><span class='id identifier rubyid_client_id'>client_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sync-instance_method">
  
    #<strong>sync</strong>(diff)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Applies an incoming update. This gets the local awareness instance in
sync with changes from another client. i.e., updates the state of another
user in the local awareness instance.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Apply an incoming update</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_update'>update</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>227</span><span class='comma'>,</span><span class='int'>245</span><span class='comma'>,</span><span class='int'>175</span><span class='comma'>,</span><span class='int'>195</span><span class='comma'>,</span><span class='int'>11</span><span class='comma'>,</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>65</span><span class='comma'>,</span><span class='int'>123</span><span class='comma'>,</span> <span class='id identifier rubyid_…'>…</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_awareness'>awareness</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Y.html" title="Y (module)">Y</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Y::Awareness (class)">Awareness</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_awareness'>awareness</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span><span class='lparen'>(</span><span class='id identifier rubyid_update'>update</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>diff</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Y::Array (class)">Array</a></span>&lt;Integer&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A binary encoded update</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/y/awareness.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sync'>sync</span><span class='lparen'>(</span><span class='id identifier rubyid_diff'>diff</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_yawareness_apply_update'>yawareness_apply_update</span><span class='lparen'>(</span><span class='id identifier rubyid_diff'>diff</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Mar 12 14:33:04 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.36 (ruby-3.2.3).
</div>

    </div>
  </body>
</html>